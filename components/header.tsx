import React, { use, useEffect, useRef, useState } from "react";
import Magentic from "./ui/magentic";
import { gsap } from "gsap";
import { CustomEase } from "gsap/CustomEase";
import Logo from "@/public/svg/Logo.svg";
import { useAppDispatch } from "@/hooks/reduxHooks";
import { toggleMenu } from "@/redux/states/menuSlice";
import { cn } from "@/lib/utils";
import { links } from "@/data/data";
import "@/app/header.css";

const ease = CustomEase.create("custom", "M0,0 C0.52,0.01 0.16,1 1,1 ");

type HeaderProps = {
  color: "Dark" | "Light";
  className?: string;
  mode?: "hamburger" | "cross";
};

export function Header({ color, className, mode = "hamburger" }: HeaderProps) {
  // const possibleTailwindClasses = [
  //   "bg-colorDark",
  //   "bg-colorLight",
  //   "text-colorDark",
  //   "text-colorLight",
  //   "before:bg-colorDark",
  //   "before:bg-colorLight",
  // ];

  const logoAnimationTl = useRef<gsap.core.Timeline | null>(null);

  useEffect(() => {
    logoAnimationTl.current = gsap.timeline({ paused: true }).fromTo(
      `.logo__rotate`,
      {
        rotate: 0,
        transformOrigin: "center",
      },
      {
        rotate: -360,
        transformOrigin: "center",
        duration: 0.6,
        ease: ease,
      },
    );

    return () => {
      logoAnimationTl.current?.kill();
    };
  }, []);

  const dispatch = useAppDispatch();
  return (
    <header className={cn("nav__container anime px-paddingX", className)}>
      <nav className="nav__bar ">
        <div className="max-w-maxWidth">
          <Magentic
            href={links.home}
            strength={50}
            className={`nav__item text-xl font-bold text-color${color} before:bg-color${color}`}
            onMouseEnter={() => {
              console.log("hello");
              logoAnimationTl.current?.play();
            }}
            onMouseLeave={() => {
              logoAnimationTl.current?.reverse();
            }}
          >
            <p className="mask logo__anim flex items-center justify-center font-semibold">
              <svg
                width="171"
                height="50"
                viewBox="0 0 171 50"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M32.984 38.86C32.9587 39.2653 32.794 39.5947 32.49 39.848C32.186 40.1013 31.8313 40.228 31.426 40.228C30.97 40.228 30.59 40.076 30.286 39.772C29.982 39.468 29.83 38.9993 29.83 38.366C29.83 36.7193 29.906 34.9333 30.058 33.008C30.21 31.0573 30.4 29.132 30.628 27.232C30.856 25.3067 31.084 23.5333 31.312 21.912C30.476 23.1027 29.564 24.42 28.576 25.864C27.6133 27.308 26.6253 28.7393 25.612 30.158C24.5987 31.5767 23.6107 32.8813 22.648 34.072C21.6853 35.2373 20.8113 36.1873 20.026 36.922C19.2407 37.6313 18.5947 37.986 18.088 37.986C17.1507 37.986 16.34 37.6187 15.656 36.884C14.972 36.124 14.63 35.174 14.63 34.034C14.63 33.578 14.6807 32.9573 14.782 32.172C14.8833 31.3613 14.9973 30.5127 15.124 29.626C15.2507 28.7393 15.3647 27.916 15.466 27.156C15.5673 26.3707 15.618 25.788 15.618 25.408C15.618 25.0533 15.58 24.7493 15.504 24.496C15.4533 24.2173 15.3267 24.078 15.124 24.078C14.82 24.078 14.402 24.42 13.87 25.104C13.338 25.7627 12.7427 26.6113 12.084 27.65C11.4507 28.6887 10.792 29.7907 10.108 30.956C9.44933 32.1213 8.82867 33.2233 8.246 34.262C7.66333 35.2753 7.16933 36.0733 6.764 36.656C6.43467 37.2133 6.13067 37.6187 5.852 37.872C5.57333 38.1253 5.23133 38.252 4.826 38.252C4.34467 38.252 3.90133 37.9987 3.496 37.492C3.116 36.9853 2.926 36.3647 2.926 35.63C2.926 35.1993 3.002 34.528 3.154 33.616C3.306 32.6787 3.496 31.6527 3.724 30.538C3.97733 29.4233 4.218 28.334 4.446 27.27C4.69933 26.1807 4.91467 25.256 5.092 24.496C5.29467 23.6347 5.548 23.052 5.852 22.748C6.156 22.444 6.48533 22.292 6.84 22.292C7.32133 22.292 7.70133 22.4693 7.98 22.824C8.284 23.1533 8.436 23.6727 8.436 24.382C8.436 24.5087 8.36 24.8507 8.208 25.408C8.056 25.94 7.866 26.5987 7.638 27.384C7.43533 28.144 7.20733 28.942 6.954 29.778C6.726 30.614 6.536 31.3867 6.384 32.096C6.94133 31.1587 7.524 30.1453 8.132 29.056C8.76533 27.9667 9.39867 26.89 10.032 25.826C10.6653 24.7367 11.2987 23.7487 11.932 22.862C12.5653 21.95 13.186 21.228 13.794 20.696C14.402 20.164 14.9847 19.898 15.542 19.898C16.2007 19.898 16.8087 20.1007 17.366 20.506C17.9487 20.9113 18.4173 21.456 18.772 22.14C19.1267 22.824 19.304 23.584 19.304 24.42C19.304 25.0027 19.2027 25.826 19 26.89C18.7973 27.9287 18.582 29.056 18.354 30.272C18.1513 31.488 18.0247 32.6407 17.974 33.73C17.974 33.9833 18.05 34.11 18.202 34.11C18.3287 34.11 18.4807 34.0213 18.658 33.844C19.3927 33.0333 20.2033 32.058 21.09 30.918C21.9767 29.7527 22.876 28.524 23.788 27.232C24.7253 25.94 25.65 24.6733 26.562 23.432C27.474 22.1653 28.3227 21.0253 29.108 20.012C29.9187 18.9733 30.628 18.15 31.236 17.542C31.8693 16.934 32.3633 16.63 32.718 16.63C33.478 16.63 34.0607 16.8453 34.466 17.276C34.8713 17.7067 35.074 18.4287 35.074 19.442C35.074 20.2527 35.0107 21.304 34.884 22.596C34.7827 23.888 34.6433 25.294 34.466 26.814C34.314 28.334 34.1367 29.8667 33.934 31.412C33.7567 32.932 33.5793 34.3507 33.402 35.668C33.2247 36.96 33.0853 38.024 32.984 38.86ZM42.1111 40.722C41.7058 40.722 41.3638 40.5573 41.0851 40.228C40.8065 39.8987 40.6671 39.4427 40.6671 38.86C40.6671 38.4293 40.7558 37.72 40.9331 36.732C41.1358 35.7187 41.3511 34.5407 41.5791 33.198C41.8325 31.8553 42.0478 30.462 42.2251 29.018C42.4025 27.5487 42.4911 26.1427 42.4911 24.8C42.4911 24.1413 42.6558 23.66 42.9851 23.356C43.3398 23.0267 43.7325 22.862 44.1631 22.862C44.5685 22.862 44.8725 23.1153 45.0751 23.622C45.2778 24.1287 45.3158 25.142 45.1891 26.662C46.3545 24.078 47.6338 22.0007 49.0271 20.43C50.4458 18.834 51.8518 17.694 53.2451 17.01C54.6385 16.3007 55.8925 15.946 57.0071 15.946C57.7418 15.946 58.2738 16.098 58.6031 16.402C58.9578 16.6807 59.1351 16.9973 59.1351 17.352C59.1351 17.8333 58.9325 18.2133 58.5271 18.492C58.1471 18.7453 57.4758 19.0493 56.5131 19.404C55.3985 19.8347 54.3725 20.3413 53.4351 20.924C52.5231 21.4813 51.6491 22.216 50.8131 23.128C50.0025 24.04 49.2045 25.2053 48.4191 26.624C47.6338 28.0173 46.8485 29.74 46.0631 31.792C45.2778 33.844 44.4418 36.314 43.5551 39.202C43.4031 39.7593 43.2005 40.152 42.9471 40.38C42.7191 40.608 42.4405 40.722 42.1111 40.722ZM72.509 23.622C72.509 24.4327 72.2557 25.2307 71.749 26.016C71.2424 26.776 70.571 27.5107 69.735 28.22C68.899 28.904 67.9744 29.55 66.961 30.158C65.9477 30.766 64.9344 31.298 63.921 31.754C62.9077 32.21 61.983 32.5773 61.147 32.856C60.9444 33.844 60.843 34.718 60.843 35.478C60.843 35.9593 60.957 36.3013 61.185 36.504C61.413 36.7067 61.7677 36.808 62.249 36.808C63.313 36.808 64.4404 36.618 65.631 36.238C66.8217 35.858 68.0377 35.364 69.279 34.756C70.5204 34.148 71.711 33.502 72.851 32.818C73.991 32.134 75.0297 31.488 75.967 30.88C76.9297 30.272 77.7277 29.778 78.361 29.398C78.9944 29.018 79.4124 28.828 79.615 28.828C79.919 28.828 80.147 28.9293 80.299 29.132C80.4764 29.3093 80.565 29.5247 80.565 29.778C80.565 29.9807 80.2484 30.3733 79.615 30.956C79.007 31.5387 78.1837 32.2227 77.145 33.008C76.1064 33.768 74.941 34.5533 73.649 35.364C72.357 36.1747 71.0144 36.9347 69.621 37.644C68.253 38.3533 66.923 38.9233 65.631 39.354C64.3644 39.7847 63.2244 40 62.211 40C60.8937 40 59.8677 39.506 59.133 38.518C58.3984 37.53 58.031 35.9973 58.031 33.92C58.031 32.5267 58.2084 31.1207 58.563 29.702C58.943 28.2833 59.4497 26.928 60.083 25.636C60.7417 24.3187 61.4637 23.1533 62.249 22.14C63.0597 21.1013 63.9084 20.2907 64.795 19.708C65.6817 19.1 66.543 18.796 67.379 18.796C68.975 18.796 70.229 19.2393 71.141 20.126C72.053 21.0127 72.509 22.178 72.509 23.622ZM61.945 29.93C62.7304 29.4487 63.541 28.942 64.377 28.41C65.213 27.878 65.9857 27.3333 66.695 26.776C67.4044 26.2187 67.9744 25.636 68.405 25.028C68.861 24.3947 69.089 23.7487 69.089 23.09C69.089 22.1527 68.5824 21.684 67.569 21.684C66.9357 21.684 66.2644 22.0893 65.555 22.9C64.871 23.6853 64.2124 24.7113 63.579 25.978C62.9457 27.2447 62.401 28.562 61.945 29.93ZM92.8661 40.418C92.6381 40.418 92.1821 40.4053 91.4981 40.38C90.8394 40.3547 90.0541 40.3167 89.1421 40.266C88.2301 40.2153 87.2801 40.1647 86.2921 40.114C85.3294 40.0633 84.4174 40.0253 83.5561 40C82.7201 39.9747 82.0234 39.962 81.4661 39.962C80.7821 39.962 80.2121 39.734 79.7561 39.278C79.3254 38.822 79.1101 38.1887 79.1101 37.378C79.1101 36.846 79.3507 36.162 79.8321 35.326C80.3134 34.49 80.9594 33.5653 81.7701 32.552C82.5807 31.5133 83.4801 30.4493 84.4681 29.36C85.4814 28.2707 86.5074 27.2067 87.5461 26.168C88.5847 25.1293 89.5854 24.1667 90.5481 23.28C91.5107 22.3933 92.3467 21.6713 93.0561 21.114C91.3841 21.3167 89.7501 21.5827 88.1541 21.912C86.5581 22.216 85.1647 22.4947 83.9741 22.748C82.8087 23.0013 82.0234 23.128 81.6181 23.128C81.1114 23.128 80.7061 22.9887 80.4021 22.71C80.0981 22.406 79.9461 22.0007 79.9461 21.494C79.9461 21.2153 80.2501 20.9367 80.8581 20.658C81.4914 20.3793 82.3274 20.1133 83.3661 19.86C84.4047 19.6067 85.5447 19.3913 86.7861 19.214C88.0527 19.0113 89.3321 18.8593 90.6241 18.758C91.9161 18.6567 93.1194 18.606 94.2341 18.606C94.9941 18.606 95.6021 18.834 96.0581 19.29C96.5394 19.746 96.7801 20.2273 96.7801 20.734C96.7801 20.9367 96.4887 21.3927 95.9061 22.102C95.3234 22.8113 94.5634 23.6727 93.6261 24.686C92.6887 25.6993 91.6627 26.7887 90.5481 27.954C89.4334 29.1193 88.3441 30.2847 87.2801 31.45C86.2161 32.59 85.2661 33.654 84.4301 34.642C83.5941 35.6047 82.9861 36.4027 82.6061 37.036C83.2901 37.0107 84.1007 36.9853 85.0381 36.96C85.9754 36.9347 86.9507 36.9093 87.9641 36.884C88.9774 36.8333 89.9401 36.7953 90.8521 36.77C91.7641 36.7193 92.5367 36.6813 93.1701 36.656C93.8287 36.6307 94.2594 36.618 94.4621 36.618C95.4754 36.618 95.9821 37.036 95.9821 37.872C95.9821 38.5053 95.6907 39.088 95.1081 39.62C94.5254 40.152 93.7781 40.418 92.8661 40.418ZM102.509 40.988C101.547 40.988 100.749 40.5447 100.115 39.658C99.5075 38.746 99.2035 37.568 99.2035 36.124C99.2035 34.7813 99.5328 33.4513 100.191 32.134C100.875 30.8167 101.775 29.55 102.889 28.334C104.004 27.118 105.22 26.0033 106.537 24.99C107.855 23.9513 109.172 23.052 110.489 22.292C111.832 21.532 113.061 20.9367 114.175 20.506C115.29 20.0753 116.177 19.86 116.835 19.86C117.19 19.86 117.481 19.936 117.709 20.088C117.937 20.2147 118.051 20.4553 118.051 20.81C118.051 21.038 117.963 21.2533 117.785 21.456C117.811 21.456 117.836 21.456 117.861 21.456C118.419 21.456 118.697 21.7853 118.697 22.444C118.697 22.672 118.609 23.1407 118.431 23.85C118.254 24.534 118.051 25.3953 117.823 26.434C117.595 27.4727 117.393 28.6253 117.215 29.892C117.038 31.1333 116.949 32.4 116.949 33.692C116.949 34.7813 117.367 35.326 118.203 35.326C119.141 35.326 120.091 35.1107 121.053 34.68C122.016 34.2493 122.953 33.73 123.865 33.122C124.777 32.4887 125.613 31.868 126.373 31.26C127.133 30.6267 127.779 30.0947 128.311 29.664C128.843 29.2333 129.223 29.018 129.451 29.018C129.654 29.018 129.831 29.0813 129.983 29.208C130.135 29.3347 130.211 29.5373 130.211 29.816C130.211 30.0693 129.958 30.5253 129.451 31.184C128.945 31.8427 128.273 32.59 127.437 33.426C126.601 34.262 125.664 35.0727 124.625 35.858C123.587 36.6433 122.523 37.2893 121.433 37.796C120.344 38.3027 119.305 38.556 118.317 38.556C117.557 38.556 116.861 38.328 116.227 37.872C115.619 37.3907 115.125 36.58 114.745 35.44C114.391 34.3 114.213 32.7293 114.213 30.728V29.778C112.972 31.83 111.667 33.7047 110.299 35.402C108.957 37.0993 107.614 38.4547 106.271 39.468C104.954 40.4813 103.7 40.988 102.509 40.988ZM116.113 22.596C115.987 22.6467 115.809 22.7227 115.581 22.824C114.416 23.356 113.2 24.0147 111.933 24.8C110.692 25.5853 109.476 26.4593 108.285 27.422C107.12 28.3847 106.069 29.3853 105.131 30.424C104.194 31.4627 103.447 32.514 102.889 33.578C102.332 34.642 102.053 35.6807 102.053 36.694C102.053 37.0233 102.117 37.2767 102.243 37.454C102.395 37.6313 102.649 37.72 103.003 37.72C103.51 37.72 104.169 37.4033 104.979 36.77C105.79 36.1113 106.677 35.25 107.639 34.186C108.627 33.122 109.615 31.944 110.603 30.652C111.591 29.36 112.529 28.0553 113.415 26.738C114.327 25.4207 115.113 24.2047 115.771 23.09C115.873 22.9127 115.987 22.748 116.113 22.596Z"
                  fill="currentColor"
                />
                <path
                  className="logo__rotate"
                  d="M137.642 36.3049C135.453 34.5688 135.453 31.7539 137.642 30.0178L143.589 25.3021C145.44 23.8344 148.263 23.6075 150.414 24.6212C151.08 24.9347 151.074 25.654 150.527 26.0881C149.979 26.5221 149.086 26.4847 148.343 26.3124C147.391 26.0918 146.321 26.2789 145.571 26.8739L139.624 31.5895C139.364 31.795 139.158 32.0397 139.017 32.3095C138.876 32.5793 138.803 32.8689 138.803 33.1613C138.803 33.4537 138.876 33.7432 139.017 34.013C139.158 34.2828 139.364 34.5276 139.624 34.7331C140.719 35.6011 142.494 35.6011 143.589 34.7331L155.482 25.3022C157.672 23.566 161.221 23.566 163.411 25.3022L169.358 30.0176C171.547 31.7538 171.547 34.5688 169.358 36.3048C167.168 38.041 163.618 38.041 161.429 36.3048L159.447 34.7331L156.969 36.6977C155.118 38.1654 152.295 38.3924 150.143 37.3787C149.478 37.0652 149.484 36.346 150.031 35.9119C150.578 35.4779 151.472 35.5152 152.215 35.6875C153.166 35.9083 154.236 35.721 154.987 35.126L157.535 33.1051C158.591 32.268 160.302 32.268 161.358 33.1051L163.411 34.7331C164.506 35.6011 166.281 35.6011 167.376 34.7331C167.636 34.5276 167.842 34.2828 167.983 34.013C168.124 33.7432 168.197 33.4537 168.197 33.1613C168.197 32.8689 168.124 32.5793 167.983 32.3095C167.842 32.0397 167.636 31.795 167.376 31.5895L161.429 26.8739C160.334 26.0059 158.559 26.0059 157.464 26.8739L145.571 36.305C143.381 38.0413 139.832 38.041 137.642 36.3049Z"
                  fill="currentColor"
                />
              </svg>
            </p>
          </Magentic>
          <Magentic
            strength={50}
            className={`mask nav__item h-8 w-8 cursor-pointer items-center text-color${color} before:bg-color${color}`}
            onClick={() => {
              if (mode === "cross") {
                dispatch(toggleMenu({ isMenuOpen: false }));
              } else {
                dispatch(toggleMenu({ isMenuOpen: true, color: color }));
              }
            }}
          >
            <div
              className={cn(
                "flex h-[0.9rem] w-full flex-col justify-between ",
                {
                  "scale-[.90] justify-center": mode === "cross",
                },
              )}
            >
              <div
                className={cn(`h-[0.15rem] w-full bg-color${color}`, {
                  "absolute rotate-45": mode === "cross",
                })}
              ></div>
              <div
                className={cn(`h-[0.15rem] w-full bg-color${color}`, {
                  "absolute -rotate-45": mode === "cross",
                })}
              ></div>
            </div>
          </Magentic>
        </div>
      </nav>
    </header>
  );
}
